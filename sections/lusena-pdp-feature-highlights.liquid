{%- liquid
  assign has_feature_blocks = false
  for block in section.blocks
    if block.type == 'feature'
      assign has_feature_blocks = true
      break
    endif
  endfor
-%}

{%- if has_feature_blocks -%}
  {%- liquid
  assign override_style = ''
  if section.settings.padding_top > 0
    assign override_style = override_style | append: '--lusena-section-padding-top-desktop:' | append: section.settings.padding_top | append: 'px;'
  endif
  if section.settings.padding_bottom > 0
    assign override_style = override_style | append: '--lusena-section-padding-bottom-desktop:' | append: section.settings.padding_bottom | append: 'px;'
  endif
  if section.settings.padding_top_mobile > 0
    assign override_style = override_style | append: '--lusena-section-padding-top-mobile:' | append: section.settings.padding_top_mobile | append: 'px;'
  endif
  if section.settings.padding_bottom_mobile > 0
    assign override_style = override_style | append: '--lusena-section-padding-bottom-mobile:' | append: section.settings.padding_bottom_mobile | append: 'px;'
  endif
-%}
<section
    class="lusena-pdp-feature-highlights lusena-spacing--standard"
  {% if override_style != blank %}
    style="{{ override_style }}"
  {% endif %}
>
    <div class="container">
      <div class="lusena-pdp-feature-highlights__grid"{% if settings.animations_reveal_on_scroll %} data-cascade{% endif %}
>
        {%- for block in section.blocks -%}
          {%- if block.type == 'feature' -%}
            {%- liquid
              assign feature_index = forloop.index
              assign feature_icon = block.settings.icon | strip
              assign feature_title = block.settings.title
              assign feature_description = block.settings.description

              assign icon_key = 'pdp_feature_' | append: feature_index | append: '_icon'
              assign title_key = 'pdp_feature_' | append: feature_index | append: '_title'
              assign description_key = 'pdp_feature_' | append: feature_index | append: '_description'

              if product != blank
                assign icon_metafield = product.metafields.lusena[icon_key]
                if icon_metafield != blank
                  if icon_metafield.value != blank
                    assign feature_icon = icon_metafield.value | strip
                  endif
                endif

                assign title_metafield = product.metafields.lusena[title_key]
                if title_metafield != blank
                  if title_metafield.value != blank
                    assign feature_title = title_metafield.value
                  endif
                endif

                assign description_metafield = product.metafields.lusena[description_key]
                if description_metafield != blank
                  if description_metafield.value != blank
                    assign feature_description = description_metafield.value
                  endif
                endif
              endif

              if feature_icon == blank
                assign feature_icon = 'sparkles'
              endif
            -%}

            <div class="lusena-pdp-feature-highlights__card{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}" {{ block.shopify_attributes }}>
              <div class="lusena-pdp-feature-highlights__icon-wrap">
                {% render 'lusena-icon', name: feature_icon, class: 'lusena-pdp-feature-highlights__icon-svg', stroke_width: 1.5 %}
              </div>
              <h3 class="lusena-pdp-feature-highlights__title">
                {{ feature_title | escape }}
              </h3>
              <p class="lusena-pdp-feature-highlights__description">
                {{ feature_description | escape | newline_to_br }}
              </p>
            </div>
          {%- endif -%}
        {%- endfor -%}
      </div>
    </div>
  </section>
{%- endif -%}

{% stylesheet %}

  .lusena-pdp-feature-highlights__grid {
    display: grid;
    grid-template-columns: repeat(1, minmax(0, 1fr));
    gap: 32px;
  }

  .lusena-pdp-feature-highlights__card {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .lusena-pdp-feature-highlights__icon-wrap {
    width: 40px;
    height: 40px;
    border-radius: 9999px;
    background-color: rgb(240 238 235 / 1);
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }

  .lusena-pdp-feature-highlights__icon-svg {
    width: 20px;
    height: 20px;
    color: rgb(14 94 90 / 1);
  }

  .lusena-pdp-feature-highlights__title {
    margin: 0;
    font-family: 'Source Serif 4', serif;
    font-size: 20px;
    line-height: 28px;
    color: rgb(17 17 17 / 1);
  }

  .lusena-pdp-feature-highlights__description {
    margin: 0;
    font-size: 14px;
    line-height: 1.625;
    color: rgb(74 74 74 / 1);
  }

  @media (min-width: 640px) {
    .lusena-pdp-feature-highlights__grid {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
  }

  @media (min-width: 1024px) {
    .lusena-pdp-feature-highlights__grid {
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 48px;
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "LUSENA PDP Features",
  "tag": "section",
  "class": "section",
  "max_blocks": 6,
  "settings": [
    {
      "type": "header",
      "content": "Spacing overrides (0 = use global default)"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Padding top (desktop)",
      "min": 0,
      "max": 240,
      "step": 4,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Padding bottom (desktop)",
      "min": 0,
      "max": 240,
      "step": 4,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_top_mobile",
      "label": "Padding top (mobile)",
      "min": 0,
      "max": 240,
      "step": 4,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_bottom_mobile",
      "label": "Padding bottom (mobile)",
      "min": 0,
      "max": 240,
      "step": 4,
      "unit": "px",
      "default": 0
    }
  ],
  "blocks": [
    {
      "type": "feature",
      "name": "Feature card",
      "settings": [
        {
          "type": "select",
          "id": "icon",
          "label": "Icon",
          "default": "sparkles",
          "options": [
            { "value": "sparkles", "label": "Sparkles" },
            { "value": "wind", "label": "Wind" },
            { "value": "shield-check", "label": "Shield Check" },
            { "value": "gift", "label": "Gift" },
            { "value": "droplets", "label": "Droplets" },
            { "value": "heart", "label": "Heart" },
            { "value": "map-pin", "label": "Map Pin" },
            { "value": "layers", "label": "Layers" },
            { "value": "package", "label": "Package" }
          ]
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Mniej zmarszczek, wiÄ™cej blasku"
        },
        {
          "type": "textarea",
          "id": "description",
          "label": "Description",
          "default": "Jedwab nie wchĹ‚ania wilgoci â€” TwĂłj krem nocny zostaje na skĂłrze, a nie na poduszce. Rano budzisz siÄ™ z nawilĹĽonÄ…, wygĹ‚adzonÄ… cerÄ…."
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "LUSENA PDP Features",
      "blocks": [
        {
          "type": "feature",
          "settings": {
            "icon": "sparkles",
            "title": "Mniej zmarszczek, wiÄ™cej blasku",
            "description": "Jedwab nie wchĹ‚ania wilgoci â€” TwĂłj krem nocny zostaje na skĂłrze, a nie na poduszce. Rano budzisz siÄ™ z nawilĹĽonÄ…, wygĹ‚adzonÄ… cerÄ…."
          }
        },
        {
          "type": "feature",
          "settings": {
            "icon": "wind",
            "title": "22 momme â€” o 30% gÄ™stszy niĹĽ standard",
            "description": "WiÄ™kszoĹ›Ä‡ poszewek to 16â€“19 momme. Nasze 22 momme to optymalny balans â€” jedwab jest gÄ™sty, trwaĹ‚y i przyjemnie chĹ‚odzÄ…cy."
          }
        },
        {
          "type": "feature",
          "settings": {
            "icon": "shield-check",
            "title": "OEKO-TEXÂ® Standard 100",
            "description": "Certyfikat potwierdza brak substancji szkodliwych. Bezpieczne dla skĂłry wraĹĽliwej i alergikĂłw."
          }
        },
        {
          "type": "feature",
          "settings": {
            "icon": "gift",
            "title": "Gotowe na prezent",
            "description": "KaĹĽda poszewka pakowana w eleganckie pudeĹ‚ko. Idealny prezent â€” bez potrzeby dodatkowego pakowania."
          }
        },
        {
          "type": "feature",
          "settings": {
            "icon": "droplets",
            "title": "Proste pranie w pralce",
            "description": "Program delikatny, zimna woda, woreczek ochronny. Jedwab zachowuje wĹ‚aĹ›ciwoĹ›ci przez setki praĹ„."
          }
        },
        {
          "type": "feature",
          "settings": {
            "icon": "heart",
            "title": "WĹ‚osy bez puszenia i Ĺ‚amania",
            "description": "GĹ‚adka powierzchnia jedwabiu zmniejsza tarcie o 43% w porĂłwnaniu do baweĹ‚ny. Mniej supĹ‚Ăłw, wiÄ™cej blasku."
          }
        }
      ]
    }
  ]
}
{% endschema %}
