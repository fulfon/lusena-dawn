{%- liquid
  assign product_form_id = 'LusenaProductForm-' | append: section.id
  assign current_variant = product.selected_or_first_available_variant
  assign price_per_night_cents = current_variant.price | divided_by: 365.0 | round
-%}

{%- liquid
  assign override_style = ''
  if section.settings.padding_top > 0
    assign override_style = override_style | append: '--lusena-section-padding-top-desktop:' | append: section.settings.padding_top | append: 'px;'
  endif
  if section.settings.padding_bottom > 0
    assign override_style = override_style | append: '--lusena-section-padding-bottom-desktop:' | append: section.settings.padding_bottom | append: 'px;'
  endif
  if section.settings.padding_top_mobile > 0
    assign override_style = override_style | append: '--lusena-section-padding-top-mobile:' | append: section.settings.padding_top_mobile | append: 'px;'
  endif
  if section.settings.padding_bottom_mobile > 0
    assign override_style = override_style | append: '--lusena-section-padding-bottom-mobile:' | append: section.settings.padding_bottom_mobile | append: 'px;'
  endif
-%}
<section
  class="lusena-pdp lusena-spacing--compact"
  data-lusena-product-section
  {% if override_style != blank %}
    style="{{ override_style }}"
  {% endif %}
>
  <script type="application/json" data-lusena-product-json>
    {{ product | json }}
  </script>

  <script src="{{ 'product-form.js' | asset_url }}" defer="defer"></script>

  <div class="container">
    {% render 'lusena-breadcrumbs', page_type: 'product', product: product, collection: collection %}

    <div class="grid grid-cols-1 md:grid-cols-12 gap-8 lg:gap-16">
      {% render 'lusena-pdp-media', product: product, current_variant: current_variant, section: section %}

      <div class="md:col-span-5 lusena-pdp-buy-box">
        <div class="lusena-pdp-buy-box__summary">
          {% render 'lusena-pdp-summary', product: product, current_variant: current_variant, section: section, price_per_night_cents: price_per_night_cents %}
        </div>

        <div class="lusena-pdp-buy-box__proof">
          {% render 'lusena-pdp-proof-chips', section: section %}
        </div>

        <div class="lusena-pdp-buy-box__desktop-divider"></div>

        <div class="lusena-pdp-buy-box__variant">
          {% render 'lusena-pdp-variant-picker', product: product, current_variant: current_variant, section: section %}
        </div>

        <div class="lusena-pdp-buy-box__atc">
          {% render 'lusena-pdp-atc', product: product, current_variant: current_variant, section: section, product_form_id: product_form_id %}
        </div>

        <div class="lusena-pdp-buy-box__guarantee">
          {% render 'lusena-pdp-guarantee', section: section %}
        </div>

        <div class="lusena-pdp-buy-box__payment">
          {% render 'lusena-pdp-payment', section: section %}
        </div>

        {%- liquid
          assign benefit_1_text = blank
          assign benefit_2_text = blank
          assign benefit_3_text = blank

          if product != blank
            assign benefit_1_metafield = product.metafields.lusena.pdp_benefit_1
            if benefit_1_metafield != blank
              if benefit_1_metafield.value != blank
                assign benefit_1_text = benefit_1_metafield.value
              endif
            endif

            assign benefit_2_metafield = product.metafields.lusena.pdp_benefit_2
            if benefit_2_metafield != blank
              if benefit_2_metafield.value != blank
                assign benefit_2_text = benefit_2_metafield.value
              endif
            endif

            assign benefit_3_metafield = product.metafields.lusena.pdp_benefit_3
            if benefit_3_metafield != blank
              if benefit_3_metafield.value != blank
                assign benefit_3_text = benefit_3_metafield.value
              endif
            endif
          endif

          assign fallback_benefit_1 = blank
          assign fallback_benefit_2 = blank
          assign fallback_benefit_3 = blank

          for block in section.blocks
            if block.type == 'benefit'
              if fallback_benefit_1 == blank
                assign fallback_benefit_1 = block.settings.text
              else
                if fallback_benefit_2 == blank
                  assign fallback_benefit_2 = block.settings.text
                else
                  if fallback_benefit_3 == blank
                    assign fallback_benefit_3 = block.settings.text
                  endif
                endif
              endif
            endif
          endfor

          if benefit_1_text == blank
            assign benefit_1_text = fallback_benefit_1
          endif
          if benefit_2_text == blank
            assign benefit_2_text = fallback_benefit_2
          endif
          if benefit_3_text == blank
            assign benefit_3_text = fallback_benefit_3
          endif

          assign has_benefit_text = false
          if benefit_1_text != blank
            assign has_benefit_text = true
          else
            if benefit_2_text != blank
              assign has_benefit_text = true
            else
              if benefit_3_text != blank
                assign has_benefit_text = true
              endif
            endif
          endif
        -%}

        {%- if has_benefit_text -%}
          <div class="lusena-pdp-buy-box__benefits-mobile">
            <ul class="lusena-pdp-buy-box__benefits-list"{% if settings.animations_reveal_on_scroll %} data-cascade{% endif %}
>
              <li class="flex items-start gap-3 text-sm text-secondary{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}">
                <span class="mt-1.5 w-1.5 h-1.5 rounded-full bg-accent-gold shrink-0"></span>
                {{ benefit_1_text | escape }}
              </li>
              <li class="flex items-start gap-3 text-sm text-secondary{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}">
                <span class="mt-1.5 w-1.5 h-1.5 rounded-full bg-accent-gold shrink-0"></span>
                {{ benefit_2_text | escape }}
              </li>
              <li class="flex items-start gap-3 text-sm text-secondary{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}">
                <span class="mt-1.5 w-1.5 h-1.5 rounded-full bg-accent-gold shrink-0"></span>
                {{ benefit_3_text | escape }}
              </li>
            </ul>
          </div>
        {%- endif -%}

        <div class="lusena-pdp-buy-box__details" data-lusena-buybox-panels>
          {% render 'lusena-pdp-buybox-panels', product: product %}
        </div>
      </div>
    </div>
  </div>

  {% render 'lusena-pdp-cross-sell', section: section %}

  {% render 'lusena-pdp-sticky-atc', product: product, current_variant: current_variant, section: section, product_form_id: product_form_id %}
</section>

{% render 'lusena-pdp-styles' %}

{% render 'lusena-pdp-scripts' %}

{% schema %}
{
  "name": "LUSENA product (draft)",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Spacing overrides (0 = use global default)"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Padding top (desktop)",
      "min": 0,
      "max": 240,
      "step": 4,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Padding bottom (desktop)",
      "min": 0,
      "max": 240,
      "step": 4,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_top_mobile",
      "label": "Padding top (mobile)",
      "min": 0,
      "max": 240,
      "step": 4,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_bottom_mobile",
      "label": "Padding bottom (mobile)",
      "min": 0,
      "max": 240,
      "step": 4,
      "unit": "px",
      "default": 0
    },
    {
      "type": "text",
      "id": "emotional_headline",
      "label": "Emotional headline",
      "default": "G\u0142adsza sk\u00f3ra i l\u015bni\u0105ce w\u0142osy \u2014 od pierwszej nocy."
    },
    {
      "type": "text",
      "id": "trust_shipping",
      "label": "Trust: shipping",
      "default": "Darmowa dostawa"
    },
    {
      "type": "text",
      "id": "trust_oeko",
      "label": "Trust: OEKO-TEX",
      "default": "OEKO-TEX\u00ae"
    },
    {
      "type": "text",
      "id": "tagline",
      "label": "Tagline",
      "default": "100% jedwab morwowy Grade 6A z Suzhou, 22 momme, certyfikat OEKO-TEX\u00ae Standard 100. Jedwab redukuje tarcie o 43% vs bawe\u0142na \u2014 Twoja sk\u00f3ra i w\u0142osy poczuj\u0105 r\u00f3\u017cnic\u0119."
    },
    {
      "type": "text",
      "id": "delivery_qualifies_label",
      "label": "Delivery: qualifies line",
      "default": "To zam\u00f3wienie kwalifikuje si\u0119 do darmowej dostawy"
    },
    {
      "type": "text",
      "id": "delivery_free_fallback_label",
      "label": "Delivery: fallback line",
      "default": "Darmowa dostawa InPost od 199 z\u0142"
    },
    {
      "type": "text",
      "id": "delivery_eta_label",
      "label": "Delivery: ETA",
      "default": "Dostawa: 1\u20132 dni robocze"
    },
    {
      "type": "text",
      "id": "delivery_returns_link_label",
      "label": "Delivery: returns link",
      "default": "60 dni na zwrot"
    },
    {
      "type": "text",
      "id": "price_per_night_prefix",
      "label": "Price-per-night prefix",
      "default": "Tylko "
    },
    {
      "type": "text",
      "id": "price_per_night_suffix",
      "label": "Price-per-night suffix",
      "default": " / noc (przy rocznym u\u017cytkowaniu)"
    },
    {
      "type": "text",
      "id": "select_color_label",
      "label": "Color selector label",
      "default": "Wybierz kolor"
    },
    {
      "type": "text",
      "id": "add_to_cart_label",
      "label": "Add to cart label",
      "default": "Dodaj do koszyka \u2013 wysy\u0142ka dzi\u015b"
    },
    {
      "type": "text",
      "id": "add_to_cart_loading_label",
      "label": "Add to cart loading label",
      "default": "Dodaj\u0119..."
    },
    {
      "type": "text",
      "id": "buy_now_label",
      "label": "Buy now label",
      "default": "Kup teraz"
    },
    {
      "type": "text",
      "id": "buy_now_loading_label",
      "label": "Buy now loading label",
      "default": "Przekierowuj\u0119..."
    },
    {
      "type": "text",
      "id": "sticky_add_to_cart_label",
      "label": "Sticky add to cart label",
      "default": "Dodaj do koszyka"
    },
    {
      "type": "text",
      "id": "sticky_add_to_cart_loading_label",
      "label": "Sticky add to cart loading label",
      "default": "Dodaj\u0119..."
    },
    {
      "type": "text",
      "id": "in_stock_label",
      "label": "In-stock label",
      "default": "Na stanie, gotowe do wysy\u0142ki"
    },
    {
      "type": "text",
      "id": "out_of_stock_label",
      "label": "Out-of-stock label",
      "default": "Chwilowo niedost\u0119pne"
    },
    {
      "type": "text",
      "id": "guarantee_heading",
      "label": "Guarantee heading",
      "default": "60 dni gwarancji spokojnego snu"
    },
    {
      "type": "text",
      "id": "guarantee_link_label",
      "label": "Guarantee link label",
      "default": "Jak to dzia\u0142a?"
    },
    {
      "type": "text",
      "id": "guarantee_body",
      "label": "Guarantee body",
      "default": "Przetestuj przez 60 nocy. Je\u015bli nie poczujesz r\u00f3\u017cnicy \u2014 zwr\u00f3\u0107, nawet u\u017cywan\u0105. Pe\u0142ny zwrot bez pyta\u0144."
    },
    {
      "type": "text",
      "id": "secure_payment_label",
      "label": "Secure payment label",
      "default": "Bezpieczna p\u0142atno\u015b\u0107"
    },
    {
      "type": "text",
      "id": "video_placeholder",
      "label": "Video placeholder",
      "default": "Video Preview"
    },
    {
      "type": "text",
      "id": "cross_sell_heading",
      "label": "Cross-sell heading",
      "default": "Pasuje do"
    }
  ],
  "blocks": [
    {
      "type": "benefit",
      "name": "Benefit",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Text",
          "default": "Reduces sleep wrinkles and morning creases"
        }
      ]
    },
    {
      "type": "cross_sell",
      "name": "Cross-sell product",
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "Product"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "LUSENA product (draft)",
      "blocks": [
        { "type": "benefit" },
        {
          "type": "benefit",
          "settings": {
            "text": "Keeps skin hydrated (doesn't absorb cream)"
          }
        },
        {
          "type": "benefit",
          "settings": {
            "text": "Prevents hair breakage and frizz"
          }
        }
      ]
    }
  ]
}
{% endschema %}
