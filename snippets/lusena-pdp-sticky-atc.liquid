{% doc %}
  PDP mobile sticky add-to-cart bar.

  @param {product} product
  @param {variant} current_variant
  @param {section} section
  @param {string} product_form_id
{% enddoc %}

{%- liquid
  assign sticky_price_per_night_cents = current_variant.price | divided_by: 365.0 | round
  assign sticky_variant_label = current_variant.title
  assign sticky_color_option_index = blank

  for option in product.options_with_values
    assign option_name_downcase = option.name | downcase
    assign is_color_option = false
    if option_name_downcase contains 'color' or option_name_downcase contains 'colour' or option_name_downcase contains 'kolor'
      assign is_color_option = true
    endif

    if is_color_option
      assign sticky_color_option_index = forloop.index0
      break
    endif
  endfor

  if sticky_color_option_index != blank
    assign sticky_variant_label = current_variant.options[sticky_color_option_index]
  endif

  assign sticky_image = current_variant.featured_media.preview_image
  if sticky_image == blank
    assign sticky_image = current_variant.featured_image
  endif
  if sticky_image == blank
    assign sticky_image = product.featured_image
  endif
-%}

<div
  class="lusena-sticky-atc fixed bottom-0 left-0 right-0 z-40 bg-surface-1 border-t border-secondary/10 px-4 py-2.5 transition-transform duration-300 transform md:hidden shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] translate-y-full"
  data-lusena-sticky-atc
>
  <div class="lusena-sticky-atc__trust flex items-center justify-center gap-1.5 pb-2 mb-2 border-b border-secondary/5">
    {% render 'lusena-icon', name: 'shield-check', class: 'lusena-sticky-atc__trust-icon w-3 h-3 text-accent-cta shrink-0', stroke_width: 2 %}
    <span class="lusena-sticky-atc__trust-text text-xs text-secondary">60 dni na zwrot</span>
  </div>

  <div class="lusena-sticky-atc__row flex items-center gap-3">
    {%- if sticky_image != blank -%}
      <img
        alt="{{ product.title | escape }}"
        class="lusena-sticky-atc__image w-11 h-11 rounded-sm object-cover shrink-0"
        width="44"
        height="44"
        src="{{ sticky_image | image_url: width: 88, height: 88, crop: 'center' }}"
        data-lusena-sticky-image
      >
    {%- else -%}
      <div class="lusena-sticky-atc__image w-11 h-11 rounded-sm object-cover shrink-0 bg-surface-2" data-lusena-sticky-image-placeholder></div>
    {%- endif -%}

    <div class="lusena-sticky-atc__meta flex flex-col flex-1 min-w-0">
      <span class="lusena-sticky-atc__price text-sm font-medium text-primary truncate" data-lusena-sticky-price>
        {{ current_variant.price | money_without_trailing_zeros }}
      </span>
      <span
        class="lusena-sticky-atc__per-night text-xs text-accent-cta"
        data-lusena-sticky-price-per-night
        data-prefix="{{ section.settings.price_per_night_prefix | escape }}"
        data-suffix="{{ section.settings.price_per_night_suffix | escape }}"
      >
        {{ section.settings.price_per_night_prefix | escape }}
        {{ sticky_price_per_night_cents | money_without_trailing_zeros }}
        {{ section.settings.price_per_night_suffix | escape }}
      </span>
      <span class="lusena-sticky-atc__variant text-xs text-secondary truncate" data-lusena-sticky-variant>{{ sticky_variant_label | escape }}</span>
    </div>

    <button
      class="lusena-sticky-atc__button inline-flex items-center justify-center whitespace-nowrap font-medium transition-colors rounded-brand focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent-cta focus-visible:ring-offset-2 disabled:pointer-events-none disabled:bg-neutral-400 disabled:text-surface-1/70 bg-accent-cta text-surface-1 hover:bg-accent-cta/90 h-11 text-xs shrink-0 px-5"
      data-lusena-sticky-atc-button
      type="submit"
      form="{{ product_form_id }}"
      {% unless current_variant.available %}disabled{% endunless %}
    >
      {{ section.settings.sticky_add_to_cart_label | escape }}
    </button>
  </div>
</div>

{% stylesheet %}
  .lusena-sticky-atc {
    padding-top: 1rem;
    padding-bottom: 1rem;
  }

  .lusena-sticky-atc__trust {
    padding-bottom: 0.8rem;
    margin-bottom: 0.8rem;
  }

  .lusena-sticky-atc__trust-text {
    font-size: 1.2rem;
    line-height: 1.6rem;
  }

  .lusena-sticky-atc__row {
    gap: 1.2rem;
  }

  .lusena-sticky-atc__image {
    width: 4.4rem;
    height: 4.4rem;
  }

  .lusena-sticky-atc__meta {
    min-width: 0;
    gap: 0;
  }

  .lusena-sticky-atc__price {
    font-size: 1.4rem;
    line-height: 2rem;
  }

  .lusena-sticky-atc__per-night,
  .lusena-sticky-atc__variant {
    font-size: 1.2rem;
    line-height: 1.6rem;
  }

  .lusena-sticky-atc__per-night {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .lusena-sticky-atc__button {
    height: 4.4rem;
    padding-left: 2rem;
    padding-right: 2rem;
    font-size: 1.2rem;
    line-height: 1.6rem;
    flex-shrink: 0;
  }
{% endstylesheet %}
