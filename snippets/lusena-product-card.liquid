{% doc %}
  Renders a LUSENA product card matching the draft-shop UI.

  @param {product} product - Shopify product
  @param {string} [badge] - Optional badge text (e.g. "Bestseller", "New")
  @param {boolean} [show_secondary_image] - If true, shows image crossfade on hover when a second image exists
  @param {string} [class] - Optional wrapper classes
{% enddoc %}

{%- liquid
  if product == blank
    break
  endif

  assign card_badge = badge | default: ''
  if card_badge == blank
    assign tags_downcase = product.tags | join: ',' | downcase
    if tags_downcase contains 'bestseller'
      assign card_badge = 'Bestseller'
    elsif tags_downcase contains 'new'
      assign card_badge = 'New'
    endif
  endif
  assign card_class = class | default: ''

  assign card_variant = product.selected_or_first_available_variant
  assign card_price = card_variant.price
  assign card_compare_at = card_variant.compare_at_price

  assign show_second = false
  if show_secondary_image and product.images.size > 1
    assign show_second = true
  endif
-%}

{%- capture primary_image_class -%}w-full h-full object-cover transition-opacity duration-200{% if show_second %} group-hover:opacity-0{% endif %}{%- endcapture -%}

<a href="{{ product.url }}" class="group block cursor-pointer {{ card_class }}">
  <div class="relative aspect-[4/5] bg-surface-2 overflow-hidden mb-4">
    {%- if card_badge != blank -%}
      <span class="absolute top-2 left-2 z-10 bg-white/90 px-2 py-1 text-[10px] uppercase tracking-wider font-medium text-primary backdrop-blur-sm">
        {{ card_badge | escape }}
      </span>
    {%- endif -%}

    {%- if product.featured_image -%}
      {{-
        product.featured_image
        | image_url: width: 1200
        | image_tag:
          class: primary_image_class,
          loading: 'lazy',
          widths: '360, 540, 720, 900, 1080, 1200',
          sizes: '(min-width: 1024px) 25vw, (min-width: 768px) 33vw, 50vw'
      -}}
    {%- else -%}
      {{ 'product-1' | placeholder_svg_tag: 'w-full h-full object-cover' }}
    {%- endif -%}

    {%- if show_second -%}
      {%- assign secondary_image = product.images[1] -%}
      {%- if secondary_image -%}
        {{-
          secondary_image
          | image_url: width: 1200
          | image_tag:
            class: 'absolute inset-0 w-full h-full object-cover opacity-0 transition-opacity duration-200 group-hover:opacity-100',
            loading: 'lazy',
            widths: '360, 540, 720, 900, 1080, 1200',
            sizes: '(min-width: 1024px) 25vw, (min-width: 768px) 33vw, 50vw'
        -}}
      {%- endif -%}
    {%- endif -%}
  </div>

  <div class="space-y-1 text-center md:text-left">
    <h3 class="text-sm font-medium text-primary">{{ product.title | escape }}</h3>
    <div class="flex items-center justify-center md:justify-start gap-2 text-sm">
      <span class="text-secondary">{{ card_price | money_without_trailing_zeros }}</span>
      {%- if card_compare_at and card_compare_at > card_price -%}
        <span class="text-secondary/50 line-through text-xs">
          {{ card_compare_at | money_without_trailing_zeros }}
        </span>
      {%- endif -%}
    </div>
  </div>
</a>
